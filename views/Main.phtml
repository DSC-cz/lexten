<article>
    <section id="stats" class="boxes d-flex">
        <div class="box">
          <div class="icon icon--color mx-auto">
               <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 111 125" class="icon--players"><path d="M317,415.81c11.65,2.42,17.88,9.83,18.09,21.54.05,2.5,0,5,0,7.49,0,9,0,8.92-9,11.42-2.05.57-4.35.23-6.15,1.67H298c-4.75-1.2-9.46-2.62-14.27-3.54-3.15-.6-3.94-2.12-3.74-5.09.26-3.79,0-7.61.07-11.41.14-12.07,6.06-19.35,17.91-22.07A60.5,60.5,0,0,1,317,415.81Z" transform="translate(-251 -333)"/><path d="M342,398.85c10.81,1.62,16.86,6.7,19.06,16,.92,4.91.12,9.87.42,14.8.11,1.78-.49,3.63.5,5.33v2c-6.55,1.63-12.91,4-19.79,4.29-2.27.08-3.28-.17-3.19-2.79.38-12.37-5.42-20.81-17.2-25.72,3.63-4,5.21-8.78,6.21-13.77C332.61,396.75,337.28,397.71,342,398.85Z" transform="translate(-251 -333)"/><path d="M312,333.09c6.7,3.57,11.95,8.2,12.23,16.53a17.21,17.21,0,0,1-14.12,17.81,17.41,17.41,0,0,1-11.94-32.25c1.26-.73,2.56-1.4,3.85-2.09Z" transform="translate(-251 -333)"/><path d="M361.93,435c-2.07-6.63-.57-13.42-.92-20.13a1.19,1.19,0,0,0,.92.16Z" transform="translate(-251 -333)"/><path d="M252.22,436.76l-1.14.2V417a.79.79,0,0,1,.82-.13C254.78,423.45,254.36,430.09,252.22,436.76Z" transform="translate(-251 -333)"/><path d="M252.22,436.76q-.16-10-.32-19.91c1.91-10.18,8.26-15.85,18.16-17.93,2.69-.53,5.44-.61,8.11-1.28a20.75,20.75,0,0,1,9.73,1.78c-.18,5.15,2.33,9.2,5.58,13.26-11.68,4.82-17.6,13.41-17.29,26,.06,2.49-1.13,2.61-3,2.44A99.55,99.55,0,0,1,252.22,436.76Z" transform="translate(-251 -333)"/><path d="M304.91,414.17c-8.25-2.17-13-7.55-13.4-15.17a16.35,16.35,0,0,1,10.64-15.84,16.07,16.07,0,0,1,18.27,5.43c7.12,9.17,2.59,21.49-9.37,25.49A5.81,5.81,0,0,1,304.91,414.17Z" transform="translate(-251 -333)"/><path d="M275,397.24c-9.56-3.94-13.79-11.75-11.05-20.35A15.82,15.82,0,0,1,282.68,366c6.43,1.39,10.4,5.55,12.21,11.78.78,2.66.62,5.06-1.84,7.14a12.45,12.45,0,0,0-4.23,7.16c-.53,2.86-2.26,4.25-4.76,5.1-1.63,1.49-3.65,1.36-5.64,1.33A6.09,6.09,0,0,1,275,397.24Z" transform="translate(-251 -333)"/><path d="M329.92,397.16c-.82-.52-2.23-.92-2.37-1.59A22.12,22.12,0,0,0,319,382c-1.38-1-.63-2.42-.37-3.68a15.91,15.91,0,0,1,14.75-12.68A16,16,0,0,1,343,395.17a40.2,40.2,0,0,1-4,2C336,399.41,333,398.58,329.92,397.16Z" transform="translate(-251 -333)"/><path d="M295.65,369.14h19.79c2.62,0,3.34.94,1.77,3.23a4.08,4.08,0,0,0-.77,1.81c-.41,4.62-2.54,6.26-7,4.26a2.67,2.67,0,0,0-1.95-.16C299,382,296.57,376.92,295.65,369.14Z" transform="translate(-251 -333)"/><path d="M304.91,414.17l6.14-.09c1.62,1.84,4.35-.14,6,1.73H298C300,413.88,302.88,415.92,304.91,414.17Z" transform="translate(-251 -333)"/><path d="M329.92,397.16c3,.17,6.06,1.09,9.08,0l2.95,1.72L328,399Z" transform="translate(-251 -333)"/><path d="M278.05,397.92l6-.76c.87,1.45,3.41.07,3.84,2.26l-9.87-.57c-.35-.21-.46-.42-.34-.63S277.93,397.92,278.05,397.92Z" transform="translate(-251 -333)"/><path d="M278.05,397.92c0,.31,0,.62,0,.93l-8,.07c1.24-1.74,3.62-.14,4.93-1.68Z" transform="translate(-251 -333)" /></svg>
           </div>
           <h2 class="count"><?=$this->getCountDbRows("users");?></h2><h3>připojených hráčů na server</h3>
        </div>

        <div class="box">
          <div class="icon icon--color mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="icon--discord" focusable="false" data-prefix="fab" data-icon="discord" class="svg-inline--fa fa-discord fa-w-20" role="img" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"/></svg>
           </div>
           <h2 class="count"><?=count($this->readJSON("https://discordapp.com/api/guilds/671711873665597450/widget.json")->members);?></h2><h3>Discord online hráčů</h3>
        </div>

        <div class="box">
            <div class="icon icon--color mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="icon--steam" focusable="false" data-prefix="fab" data-icon="steam" class="svg-inline--fa fa-steam fa-w-16" role="img" viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111.2 248-248.4 248-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4 39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5 0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8 384.8 8 496 119 496 256zM155.7 384.3l-30.5-12.6a52.79 52.79 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4 5.4-13 5.5-27.3.1-40.3-5.4-13-15.5-23.2-28.5-28.6-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7-8.3 19.9-31 29.2-50.8 21zm173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3 62.4 28 62.4 62.3-27.9 62.3-62.4 62.3zm.1-15.6c25.9 0 46.9-21 46.9-46.8 0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8z"/></svg>
            </div>
           <h2 class="count"><?=$this->readXML("https://steamcommunity.com/gid/103582791466694340/memberslistxml/?xml=1")->groupDetails->memberCount?></h2><h3>LEXTEN.cz Steam členů</h3>
        </div>

        <div class="box">
            <div class="icon icon--color mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="icon--freevip" focusable="false" data-prefix="fas" data-icon="gift" class="svg-inline--fa fa-gift fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M32 448c0 17.7 14.3 32 32 32h160V320H32v128zm256 32h160c17.7 0 32-14.3 32-32V320H288v160zm192-320h-42.1c6.2-12.1 10.1-25.5 10.1-40 0-48.5-39.5-88-88-88-41.6 0-68.5 21.3-103 68.3-34.5-47-61.4-68.3-103-68.3-48.5 0-88 39.5-88 88 0 14.5 3.8 27.9 10.1 40H32c-17.7 0-32 14.3-32 32v80c0 8.8 7.2 16 16 16h480c8.8 0 16-7.2 16-16v-80c0-17.7-14.3-32-32-32zm-326.1 0c-22.1 0-40-17.9-40-40s17.9-40 40-40c19.9 0 34.6 3.3 86.1 80h-86.1zm206.1 0h-86.1c51.4-76.5 65.7-80 86.1-80 22.1 0 40 17.9 40 40s-17.9 40-40 40z"/></svg>
            </div>
           <h2 class="count"><?=$this->getCountDbRows("freevip_users");?></h2><h3>Rozdaných FREE VIP</h3>
        </div>

        
    </section>
    <section id="latest_news" class="latest-news disabled">
            <?php
                $news = Clanek::selectNews(3);
                $i = 0;
                foreach($news as $post){
                    echo '<div class="latest-news__post"><a href="/clanek/'.$post['alias'].'">';
                    echo '<img src="'.$post['image'].'" onerror="this.src=\'/images/no-image.png\'" alt="Obrázek novinky">';
                    echo '<h1>'.$post['nazev'].'</h1>';
                    echo ($i == 0 ? '<p>'.mb_substr(strip_tags((!empty($post['sub']) ? $post['sub'] : $post['text'])),0,400,'utf-8').(strlen($post['sub']) > 400 ? '...' : '').'</p>' : '');
		    if($i == 0) echo strlen($post['sub']) < 400 ? '<p>'.mb_substr(strip_tags($post['text']), 0, 400-strlen($post['sub'])).'...</p>' : "";
                    echo '</a></div>';
                    $i++;
                }
            ?>
            <a href="/clanek/archiv" class="btn mt-2 btn-secondary latest-news__button">Zobrazit více novinek</a>
<button class="btn btn-success mt-2 latest-news__button click-copy" data-toggle="tooltip" data-placement="bottom" data-original-title="Zkopíruje příkaz pro připojení" data-content="connect 82.208.17.49:27479">Začít hrát<br/>82.208.17.49:27479</button>
<a href="https://discord.gg/Zb8ZmegHuq" class="btn btn-discord mt-2 latest-news__button">Připojit se na discord server</a>
    </section>

    <section id="latest_posts" class="odkazy disabled">
        <?php
            $lastposts_q = Forum::getTopics(-1, 0, 5, "a.datum DESC", true);
            $lastposts = array();
            if($lastposts_q["status"]) foreach($lastposts_q["results"] as $row) $lastposts[] = $row;
        ?>
        <h3>Poslední příspěvky</h3>
        <table class="table table-dark table-striped">
		<tbody>
			<?php for($i = 0; $i < count($lastposts); $i++){
				?>
			<tr>
				<td>
					<a href="/forum/topic/<?=$lastposts[$i]['podrazeno'] == 0 ? $lastposts[$i]['id'] : $lastposts[$i]['podrazeno']?>"><?=str_replace("Re: ", "", $lastposts[$i]['nazev']);?></a>
				</td>
				<td class="lastcomment">
					<img src="<?=$lastposts[$i]['avatarsmall']?>" class="avatar" alt="Avatar"/>
					<a href="/stats/<?=$lastposts[$i]['author']?>" title="<?=$lastposts[$i]['nick']?>" class="main" style="max-width:55px;height:18px<?=!empty($lastposts[$i]['barva']) ? ';color: #'.$lastposts[$i]['barva'].'' : ''?>"><?=$lastposts[$i]['nick']?> </a>
					~ <?=round((strtotime("now") - strtotime($lastposts[$i]['datum']))/60/60, 1)?>h
				</td>
			</tr>
			<?php
			}
			?>
		</tbody>
	</table>
    </section>

    <?php 
        $ip = "82.208.17.49";
        $port = 27479;
        $status = $this->serverStatus($ip, $port);
    ?>

    <section id="server_status">
        <div id="map">
            <img id="actualmap" src="https://lexten.cz/images/maps/<?=$status["map"]?>.jpg" onerror="this.onerror=null; this.src='https://lexten.cz/images/maps/default.jpg'" class="server-map" alt="Serverová mapa">
            <div class="info">
                <div id="onlineplayers" class="players"><?=$status["activity"]?></div>
                    <img src="https://lexten.cz/images/ct_logo.png" alt="CT"> <span id="ct_rounds" class="ct"><?=$status["CTWins"]?></span> : <span id="t_rounds" class="t"><?=$status["TWins"]?></span> <img src="https://lexten.cz/images/t_logo.png" alt="T">
                </div>
                <button id="players" class="small "><i class="fas fa-chevron-left" aria-hidden="true"></i></button>
            </div>
            <div class="menu server-status-menu">
                <a href="steam://connect/<?=$ip?>:<?=$port?>"><button class="join"><i class="fas fa-location-arrow" aria-hidden="true"></i> Začít hrát<br><span class="button-ip">82.208.17.49:27479</span></button></a>
                <div class="copy"><button id="ip_copy" class="click-copy" title="Zkopírovat IP" data-content="<?=$ip?>:<?=$port?>"><i class="fas fa-copy" aria-hidden="true"></i></button><p class="copied">Zkopírováno</p></div>
            <ul id="playerlist" class="list">  
                <?php
                    foreach($status["players"] as $player){
                        ?>
                            <li><span class="blue bold"><?=$player["name"]?></span> <span class="darkgray">&nbsp;|&nbsp;</span> <?=$player["time"]?></li>
                        <?php
                    }
                ?>
            </ul>
        </div>
    </section>

    <section id="freevip" class="disabled">
        <div>
            <img src="https://lexten.cz/images/freevip.png?ver=0" alt="FreeVIP obrázek" />
        </div>
	<div>
	   <p class="bold">Pro aktivaci je nutno splnit 2 podmínky:</p>
	   <ul>
		<li>Být přihlášen na webu</li>
		<li>Po celou dobu aktivace být součástí <a href="https://steamcommunity.com/groups/lexten">komunity Steam</a> <i class="t fas fa-info-circle" data-toggle="tooltip" data-placement="bottom" title="Pokud nebudete připojeni ve Steam skupině během aktivního FREE VIP, výhody se Vám na serveru při připojení neaktivují."></i></li>
	   </ul>
        <?php 
            $freevip = $this->freevip();

            if($freevip['loggedin'] == 0) echo'<button class="btn btn-warning" disabled>Pro tuto akci musíš být přihlášen</button>';
            else if($freevip['already_activated'] == 1) echo '<button class="btn btn-danger" disabled>Už sis FreeVIP aktivoval.</button>';
            else if($freevip['proxy'] == 1) echo '<button class="btn btn-danger" disabled>Byla detekována Proxy/VPN.</button>';
            else echo '<form action="" method="POST"><button name="freevip_activate" class="btn btn-success">Aktivovat FreeVIP na 5 dní</button></form>';
        ?>
	</div>
    </section>

    <section id="ads" class="row">
            <div class="col-sm mb-3">
                <a href="https://www.nonsteam.cz"><img src="https://www.nonsteam.cz/img/banners/nonsteam_468x60.gif" alt="nonsteam.cz - seznam CZ/SK Non-Steam Counter Strike serverů"></a>
            </div>
            <div class="col-sm mb-3">
                <a href='http://www.serverbook.cz' title='Minecraft servery' target='_blank'><img src='http://www.serverbook.cz/images/banner_60_468_v2.png?v=1' alt='ServerBook.cz'  /></a>
            </div>
            <div class="col-sm mb-3">
                <a href='http://www.madlist.eu'><img src="https://madlist.eu/inc/img/banners/60_468.png" alt='MadList.eu - Váš serverlist!'></a>
            </div>
    </section>
</article>